@if (FEATURE_FLAG_PORTAL_INFOBANNER) {
  <app-info-banner-section></app-info-banner-section>
}

<mat-toolbar class="app-navbar-demis" role="toolbar" aria-label="Hauptnavigation">
  <!-- #region Header LOGOS ("I am local" and "DEMIS Logo") -->
  @if (env.isLocal) {
    <img id="img-local-indicator-logo" alt="local indicator Logo" src="assets/images/local-indicator.gif"/>
  }

  <button mat-button id="home-button" routerLink="/" aria-label="Startseite">
    <img id="img-demis-logo" src="{{ demisLogoUrl }}" alt="DEMIS Logo"/>
  </button>
  <!-- #endregion Header LOGOS -->


  <!-- #region NAV BAR - DEPRECATED - ("Startseite", "Erregernachweis", "Krankheit", "Betten", "IGS",...) -->
  @if (!FEATURE_FLAG_PORTAL_HEADER_FOOTER()) {
    <nav mat-tab-nav-bar class="navbar-tab-group" [tabPanel]="tabPanel" role="tablist" aria-label="Hauptnavigation">
      @if (isLoggedIn()) {
        <a id="a-to-homepage" [class.active-tab]="activeTab === C.Tabs.HOME"
           [class.inactive-tab]="activeTab !== C.Tabs.HOME"
           mat-tab-link routerLink="./" routerLinkActive="active" tabindex=0>
          {{ C.Labels.START_PAGE_LINK }}
        </a>
      }

      @if (!isFollowUpNotificationDiseaseActivated() && hasDiseaseNotificationSenderRole) {
        <a id="a-to-disease" [class.active-tab]="isDiseaseTabActive"
           [class.inactive-tab]="!isDiseaseTabActive" mat-tab-link
           (click)=navigateToDisease() routerLinkActive="active">
          Krankheit (§ 6 IfSG)
        </a>
      }

      @if (isFollowUpNotificationDiseaseActivated() && hasDiseaseNotificationSenderRole) {
        <button id="btn-disease" class="navbar-menu-btn" mat-button [matMenuTriggerFor]="menu"
                [class.active-tab]="isDiseaseTabActive"
                [class.inactive-tab]="!isDiseaseTabActive">Krankheit (§ 6 IfSG)
          <mat-icon iconPositionEnd fontIcon="arrow_drop_down" class="btn__icon"></mat-icon>
        </button>
        <mat-menu #menu="matMenu" class="menu-width_disease">
          <a id="a-to-disease-nominal"
             mat-menu-item [routerLink]="C.PathSegments.DISEASE_NOTIFICATION">Erstmeldung</a>
          <a id="a-to-disease-follow-up" mat-menu-item [routerLink]="C.PathSegments.DISEASE_NOTIFICATION_FOLLOW_UP">Folgemeldung</a>
        </mat-menu>
      }

      @if (!isFollowUpNotificationPathogenActivated() && (hasPathogenNotificationSenderRole)) {
        <a id="a-to-pathogen" [class.active-tab]="isPathogenTabActive" [class.inactive-tab]="!isPathogenTabActive"
           mat-tab-link [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION" routerLinkActive="active">
          Erregernachweis (§ 7 Abs. 1 IfSG)
        </a>
      }

      @if (isFollowUpNotificationPathogenActivated() && (hasPathogenNotificationSenderRole)) {
        <button id="btn-pathogen" class="navbar-menu-btn" mat-button [matMenuTriggerFor]="menu"
                [class.active-tab]="isPathogenTabActive"
                [class.inactive-tab]="!isPathogenTabActive">Erregernachweis (§ 7 Abs. 1 IfSG)
          <mat-icon iconPositionEnd fontIcon="arrow_drop_down" class="btn__icon"></mat-icon>
        </button>
        <mat-menu #menu="matMenu" class="menu-width_pathogen">
          <a id="a-to-pathogen-nominal"
             mat-menu-item [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION">Erstmeldung</a>
          <a id="a-to-pathogen-follow-up" mat-menu-item [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION_FOLLOW_UP">Folgemeldung</a>
        </mat-menu>
      }

      @if (isNonNominalNotificationActivated() && (showNonNominalLinks)) {
        <button class="navbar-menu-btn" id="btn-non-nominal" mat-button [matMenuTriggerFor]="menu"
                [class.active-tab]="isNonNominalTabActive"
                [class.inactive-tab]="!isNonNominalTabActive">§ 7 Abs. 3 IfSG
          <mat-icon iconPositionEnd fontIcon="arrow_drop_down" class="btn__icon"></mat-icon>
        </button>
        <mat-menu #menu="matMenu">
          <a id="a-to-pathogen-non-nominal" mat-menu-item
             [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION_NON_NOMINAL">Erregernachweis</a>
          <a id="a-to-disease-non-nominal" mat-menu-item (click)="navigateToDiseaseNonNominal()">Ärztliche
            Ergänzungsmeldung</a>
        </mat-menu>
      }


      @if (hasBedOccupencySenderRole) {
        <a id="a-to-bed-occupancy" [class.active-tab]="activeTab === C.Tabs.BED_OCCUPANCY"
           [class.inactive-tab]="activeTab !== C.Tabs.BED_OCCUPANCY" mat-tab-link
           [routerLink]="C.PathSegments.BED_OCCUPANCY"
           routerLinkActive="active">
          {{ C.Labels.SUBMIT_BED_OCCUPANCY_LINK }}
        </a>
      }

      @if (hasIgsDataSenderRole && hasIgsNotificationSenderRole) {
        <a id="a-to-sequence-notification" [class.active-tab]="activeTab === C.Tabs.SEQUENCE_NOTIFICATION"
           [class.inactive-tab]="activeTab !== C.Tabs.SEQUENCE_NOTIFICATION" mat-tab-link
           [routerLink]="C.PathSegments.SEQUENCE_NOTIFICATION" routerLinkActive="active">
          IGS
        </a>
      }
    </nav>
  }
  <!-- #endregion NAV BAR - DEPRECATED - ("Startseite", "Erregernachweis", "Krankheit", "Betten", "IGS",...)-->

  <mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>

  <!-- #region "drei-punkte-menü" - DEPRECATED - -->
  <span class="toolbar-spacer"></span>
  @if (!FEATURE_FLAG_PORTAL_HEADER_FOOTER()) {
    <button mat-icon-button id="btn-burger-menu-in-navbar" [matMenuTriggerFor]="burgerMenu"
            aria-label="Öffne Burgermenü">
      <mat-icon fontIcon="more_vert"></mat-icon>
    </button>

    <mat-menu #burgerMenu="matMenu" aria-label="Menü">
      <!-- ABOUT -->
      <button mat-menu-item id="a-to-about" [routerLink]="C.PathSegments.ABOUT" routerLinkActive="active">
        {{ C.Labels.ABOUT_DEMIS_LINK }}
        {{ version }}
      </button>

      <!-- DATA ANALYSIS -->
      <button mat-menu-item id="a-to-data-analyse" (click)="openInNewTab(C.ExternalLinks.DATA_ANALYSIS)">
        {{ C.Labels.DATA_ANALYSIS_LINK }}
      </button>

      <!-- HELP (See submenu below for entries) -->
      <button mat-menu-item id="btn-help-menu-inside-burger-menu" [matMenuTriggerFor]="helpMenu">
        {{ C.Labels.HELP_LINK }}
      </button>

      <!-- SITE NOTICE -->
      <button mat-menu-item id="a-to-site-notice" routerLink="/impressum" routerLinkActive="active">
        {{ C.Labels.SITE_NOTICE_LINK }}
      </button>

      <!-- PRIVACY POLICY -->
      <button mat-menu-item id="a-to-privacy-policy" routerLink="/privacy-policy" routerLinkActive="active">
        {{ C.Labels.PRIVACY_POLICY }}
      </button>
    </mat-menu>

    <!-- HELP SUBMENU -->
    <mat-menu #helpMenu="matMenu">
      <!-- KNOWLEDGE DATABASE -->
      <button mat-menu-item id="a-to-demis-wdb" (click)="openInNewTab(C.ExternalLinks.DEMIS_WDB)">
        <mat-icon>assessment</mat-icon>
        {{ C.Labels.DEMIS_KNOWLEDGE_DATABASE_LINK }}
      </button>

      <!-- SUPPORT -->
      <button mat-menu-item id="a-to-support" (click)="openInNewTab(C.ExternalLinks.CONTACT_SUPPORT)">
        <mat-icon>contact_support</mat-icon>
        {{ C.Labels.SUPPORT_QUESTIONS_LINK }}
      </button>
    </mat-menu>
  }
  <!-- #endregion "drei-punkte-menü" - DEPRECATED - -->


  <!-- #region BURGER MENU (redesign NEW instead of "drei-punkte-menü")-->
  @if (FEATURE_FLAG_PORTAL_HEADER_FOOTER()) {
    <button type="button" mat-button id="btn-burger-menu-in-navbar" class="menu-button" [matMenuTriggerFor]="burgerMenu"
            aria-haspopup="menu" aria-label="Menü öffnen" tabindex=0>
      <mat-icon fontIcon="menu"></mat-icon>
      Menu
    </button>
    <mat-menu #burgerMenu="matMenu" class="burger-menu" aria-label="Formularseitenmenü">
      @if (isLoggedIn()) {
        <div class="menu-header" role="separator" aria-hidden="true">Gesetzliche Meldepflichten</div>
        @if (!isFollowUpNotificationDiseaseActivated() && hasDiseaseNotificationSenderRole) {
          <button mat-menu-item id="a-to-disease" (click)="navigateToDisease()" routerLinkActive="active"
                  role="menuitem" aria-label="Krankheit Paragraph 6 IfSG">
            Krankheit (§ 6 IfSG)
          </button>
        }
        @if (isFollowUpNotificationDiseaseActivated() && hasDiseaseNotificationSenderRole) {
          <button mat-menu-item [matMenuTriggerFor]="diseaseMenu" role="menuitem" aria-label="Krankheit Paragraph 6
            IfSG">Krankheit (§ 6
            IfSG)
          </button>
          <mat-menu #diseaseMenu="matMenu">
            <button mat-menu-item id="a-to-disease-nominal" [routerLink]="C.PathSegments.DISEASE_NOTIFICATION">
              Erstmeldung
            </button>
            <button mat-menu-item id="a-to-disease-follow-up"
                    [routerLink]="C.PathSegments.DISEASE_NOTIFICATION_FOLLOW_UP">
              Folgemeldung
            </button>
          </mat-menu>
        }
        @if (!isFollowUpNotificationPathogenActivated() && (hasPathogenNotificationSenderRole)) {
          <button mat-menu-item id="a-to-pathogen" [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION"
                  routerLinkActive="active" role="menuitem"
                  aria-label="Erregernachweis Paragraph 7 Abschnitt 1 IfSG">
            Erregernachweis (§ 7 Abs. 1 IfSG)
          </button>
        }
        @if (isFollowUpNotificationPathogenActivated() && (hasPathogenNotificationSenderRole)) {
          <button mat-menu-item [matMenuTriggerFor]="pathogenMenu" role="menuitem"
                  aria-label="Erregernachweis Paragraph 7 Abschnitt 1 IfSG">Erregernachweis
            (§ 7 Abs. 1 IfSG)
          </button>
          <mat-menu #pathogenMenu="matMenu">
            <button mat-menu-item id="a-to-pathogen-nominal" [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION">
              Erstmeldung
            </button>
            <button mat-menu-item id="a-to-pathogen-follow-up"
                    [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION_FOLLOW_UP">
              Folgemeldung
            </button>
          </mat-menu>
        }
        @if (isNonNominalNotificationActivated() && (showNonNominalLinks)) {
          <button mat-menu-item [matMenuTriggerFor]="nonNominalMenu" role="menuitem"
                  aria-label="Paragraph 7 Abschnitt 3 IfSG">§ 7 Abs. 3 IfSG
          </button>
          <mat-menu #nonNominalMenu="matMenu">
            <button mat-menu-item id="a-to-pathogen-non-nominal"
                    [routerLink]="C.PathSegments.PATHOGEN_NOTIFICATION_NON_NOMINAL">Erregernachweis
            </button>
            <button mat-menu-item id="a-to-disease-non-nominal" (click)="navigateToDiseaseNonNominal()">Ärztliche <br>Ergänzungsmeldung
            </button>
          </mat-menu>
        }
      }
      @if (isLoggedIn() && (hasBedOccupencySenderRole || (hasIgsDataSenderRole && hasIgsNotificationSenderRole))) {
        <div class="menu-header" role="separator" aria-hidden="true">Weitere Surveillance-Systeme</div>
      }
      @if (hasBedOccupencySenderRole) {
        <button mat-menu-item id="a-to-bed-occupancy" [routerLink]="C.PathSegments.BED_OCCUPANCY"
                routerLinkActive="active" role="menuitem">
          {{ C.Labels.SUBMIT_BED_OCCUPANCY_LINK }}
        </button>
      }
      @if (hasIgsDataSenderRole && hasIgsNotificationSenderRole) {
        <button mat-menu-item id="a-to-sequence-notification" [routerLink]="C.PathSegments.SEQUENCE_NOTIFICATION"
                routerLinkActive="active" role="menuitem">
          IGS
        </button>
      }
      <mat-divider class="menu-divider" aria-hidden="true"></mat-divider>
      <button mat-menu-item id="a-to-about" [routerLink]="C.PathSegments.ABOUT" routerLinkActive="active"
              role="menuitem">
        <mat-icon>info</mat-icon>
        {{ C.Labels.ABOUT_DEMIS_LINK }}
      </button>
      <button mat-menu-item id="a-to-data-analyse" (click)="openInNewTab(C.ExternalLinks.DATA_ANALYSIS)"
              role="menuitem">
        <mat-icon>radar</mat-icon>
        {{ C.Labels.DATA_ANALYSIS_LINK }}
      </button>
      <button mat-menu-item id="btn-help-menu-inside-burger-menu" [matMenuTriggerFor]="helpMenu" role="menuitem"
              aria-haspopup="menu">
        <mat-icon>help</mat-icon>
        {{ C.Labels.HELP_LINK }}
      </button>
    </mat-menu>
    <mat-menu #helpMenu="matMenu">
      <button mat-menu-item id="a-to-demis-wdb" (click)="openInNewTab(C.ExternalLinks.DEMIS_WDB)" role="menuitem">
        {{ C.Labels.DEMIS_KNOWLEDGE_DATABASE_LINK }}
      </button>
      <button mat-menu-item id="a-to-support" (click)="openInNewTab(C.ExternalLinks.CONTACT_SUPPORT)" role="menuitem">
        {{ C.Labels.SUPPORT_SUPPORT_LINK }}
      </button>
      <button mat-menu-item id="a-to-faq" (click)="openInNewTab(C.ExternalLinks.SUPPORT_FAQ)" role="menuitem"
              aria-label="Frequently asked questions">
        {{ C.Labels.SUPPORT_FAQ_LINK }}
      </button>
    </mat-menu>
  }
  <!-- #endregion BURGER MENU (redesign NEW instead of "drei-punkte-menü")-->
  <mat-tab-nav-panel #tabPanel></mat-tab-nav-panel>


  <!-- #region AUTH BUTTON ("anmelden"/"abmelden") -->
  @if (isLoggedIn()) {
    <button type="button" mat-button id="btn-navbar-auth_logout" class="btn-navbar-auth" (click)="logout()"
            aria-label="Abmelden">
      <mat-icon fontSet="material-icons">person</mat-icon>
      Abmelden
    </button>
  } @else {
    <button type="button" mat-button id="btn-navbar-auth_login" class="btn-navbar-auth" (click)="login()"
            aria-label="Anmelden">
      <mat-icon fontSet="material-icons-outlined">person</mat-icon>
      Anmelden
    </button>
  }
  <!-- #endregion AUTH BUTTON ("anmelden"/"abmelden")-->
</mat-toolbar>


<mat-divider class="navbar-to-content-divider" aria-hidden="true"></mat-divider>
